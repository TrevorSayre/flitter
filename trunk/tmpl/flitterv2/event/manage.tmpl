<?php
  require_once $templater->get_path_str('flitter/flitter_library.php','php');
  require_once $templater->get_path_str('user_session.php','php');

  //Hack so I don't have to change code
  $user = $args['user'];
  
  //Guest User, Redirect them to login
  if($user->get_id() == -1)
    header('Location: '.$templater->get_http_path('account/login'));

  $flitter = new FlitterLibrary();
  $commitments = $flitter->getUserCommitments($user->get_id());
?>

<br/>
<a href="<?=$templater->get_http_path('event/create');?>">Create an Event</a>
<br/>
<br/>
<?php
  foreach($commitments as $commitment) {
    $event = $flitter->getEventById($commitment['event_id']);
    $eventCommitments = $flitter->getEventCommitments($event['event_id']);
    echo '(',$commitment['type'],') <a href="',$templater->get_http_path('event/view/'.$event['event_id']),
	  '" alt="',$event['event_title'],'"><b>',$event['event_title'],'</b></a>
	  @ ',$event['event_loc'],'. ',count($eventCommitments),' people involved so far<br/>';
    foreach($eventCommitments as $eventCommitment) {
      $eventUser = $flitter->getUserById($eventCommitment['user_id']);
      echo '--> ('.$eventCommitment['type'].') '.$eventUser['email'].'<br/>';
    }
    echo "<br/><br/>";
  }
?>
<br/>